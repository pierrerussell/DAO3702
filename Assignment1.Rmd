---
title: "DBA3702 Assignment 1"
author: "weRready"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
geometry: margin=1in
fontsize: 11pt
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE,
                      fig.width = 8, fig.height = 6, fig.align = "center")
```

\newpage

# Part 1: Data Wrangling with dplyr

## Question 1.1: Data Exploration

### a) Load packages and read data

```{r q1.1a}
library(dplyr)
library(tibble)

employees <- read.csv("data/employees.csv")
```

### b) Convert to tibble and display first 10 rows

```{r q1.1b}
employees <- as_tibble(employees)
print(employees, n = 10)
```

### c) Data summary

```{r q1.1c}
cat("Rows:", nrow(employees), "\n")
cat("Columns:", ncol(employees), "\n")

sapply(employees, typeof)
summary(employees)
```

The dataset includes information about 50 employees with 8 variables. This includes basic information, such as employee name and department, as well as quantitative information, such as salary, years of experience, performance scores, and number of projects completed.

\newpage

## Question 1.2: Selecting and Filtering

### d) Select specific columns

```{r q1.2d}
employees %>%
  select(name, department, role, performance_score)
```

### e) Select employees with performance \> 4.0

```{r q1.2e}
high_performers <- employees %>%
  filter(performance_score > 4.0)
high_performers
```

### f) Select employees in Engineering/Marketing with \> 5 years experience

```{r q1.2f}
employees %>%
  filter((department == "Engineering" | department == "Marketing") & years_exp > 5)
```

### g) Select columns using helpers

```{r q1.2g}
employees %>%
  select(contains("score") | starts_with("p"))
```

There are two columns, *performance_score* and *projects_completed*, that meet the given condition.

\newpage

## Question 1.3: Sorting and Ranking

### h) Identify top 5 highest-paid employees

```{r q1.3h}
employees %>%
  arrange(desc(salary)) %>%
  head(5)
```

### i) Sort by department, then performance

```{r q1.3i}
employees %>%
  arrange(department, desc(performance_score))
```

### j) Identify employee with lowest salary in each department

```{r q1.3j}
employees %>%
  arrange(department, salary) %>%
  group_by(department) %>%
  slice_head(n = 1) %>%
  ungroup()
```

\newpage

## Question 1.4: Creating New Variables

### k) Salary per year of experience

```{r q1.4k}
employees %>%
  mutate(salary_per_year_exp = salary / years_exp) %>%
  select(name, salary, years_exp, salary_per_year_exp)
```

### l) Performance category

```{r q1.4l}
employees_cat <- employees %>%
  mutate(performance_category = case_when(
    performance_score >= 4.5 ~ "Outstanding",
    performance_score >= 3.5 ~ "Exceeds Expectations",
    performance_score >= 2.5 ~ "Meets Expectations",
    TRUE ~ "Needs Improvement"
  ))

employees_cat %>%
  select(name, performance_score, performance_category)
```

### m) Experience level

```{r q1.4m}
employees_exp <- employees %>%
  mutate(experience_level = case_when(
    years_exp <= 3 ~ "Entry",
    years_exp <= 7 ~ "Mid",
    years_exp <= 12 ~ "Senior",
    TRUE ~ "Expert"
  ))

employees_exp %>%
  select(name, years_exp, experience_level)
```

### n) High performer flag

```{r q1.4n}
employees %>%
  mutate(is_high_performer = performance_score > 4.0 & projects_completed >= 10) %>%
  filter(is_high_performer) %>%
  select(name, department, performance_score, projects_completed)
```

\newpage

## Question 1.5: Aggregation and Grouping

### o) Company-wide summary

```{r q1.5o}
employees %>%
  summarise(
    total_employees = n(),
    avg_salary = mean(salary),
    avg_performance = mean(performance_score),
    total_projects = sum(projects_completed)
  )
```

### p) Summary by department

```{r q1.5p}
employees %>%
  group_by(department) %>%
  summarise(
    count = n(),
    avg_salary = mean(salary),
    avg_perf = mean(performance_score),
    min_exp = min(years_exp),
    max_exp = max(years_exp)
  )
```

### q) Summary by department and role

```{r q1.5q}
dept_role <- employees %>%
  group_by(department, role) %>%
  summarise(avg_salary = mean(salary), count = n(), .groups = "drop") %>%
  arrange(desc(avg_salary))

dept_role

# Highest combo:
dept_role %>% head(1)
```

Managers in the Engineering department have the highest salary on average.

### r) Individual employees' salary as % of department average

```{r q1.5r}
employees %>%
  group_by(department) %>%
  mutate(
    dept_avg = mean(salary),
    pct_of_avg = salary / dept_avg * 100
  ) %>%
  ungroup() %>%
  arrange(desc(pct_of_avg)) %>%
  select(name, department, salary, dept_avg, pct_of_avg)
```

Bella Moore from Finance department earns the most relative to their department's average, with a relative percentage of 156.37%.

### s) Top 3 departments by performance (only considering employees with 3+ years of experience)

```{r q1.5s}
employees %>%
  filter(years_exp >= 3) %>%
  group_by(department) %>%
  summarise(avg_perf = mean(performance_score)) %>%
  arrange(desc(avg_perf)) %>%
  head(3)
```

Only taking into account the work of employees with 3 or more years of experience, the Engineering, Finance, and Sales departments show the best average performance.

\newpage

# Part 2: Social Network Analysis

## Question 2.1: Network Construction and Visualization

### t) Load network data

```{r q2.1t}
library(igraph)
library(RColorBrewer)

email_nodes <- read.csv("data/email_nodes.csv")
email_edges <- read.csv("data/email_edges.csv")

head(email_nodes)
head(email_edges)
```

### u) Construct undirected graph

```{r q2.1u}
email_graph <- graph.data.frame(email_edges, vertices = email_nodes, directed = FALSE)

cat("Nodes:", vcount(email_graph), "\n")
cat("Edges:", ecount(email_graph), "\n")
```

### v) Create plot of network

```{r part_v}
# v) Improved plot
set.seed(45)
mylayout <- layout.auto(email_graph)

# Basic plot
plot(email_graph, layout = mylayout)

# Improved plot
par(mar = c(0, 0, 0, 0))
deg <- degree(email_graph)

plot(email_graph, layout = mylayout, vertex.label = NA,
  vertex.size = sqrt(deg) * 3, edge.width = 0.5,
  main = "Improved Plot")
```

### w) Department-colored network

```{r q2.1w}
depts <- V(email_graph)$department
unique_depts <- unique(depts)
colors <- brewer.pal(length(unique_depts), "Set1")
names(colors) <- unique_depts

par(mfrow = c(1, 1), mar = c(1, 1, 2, 5))
plot(email_graph, vertex.label = NA, vertex.size = sqrt(deg) * 2,
     vertex.color = colors[depts], edge.width = 0.5,
     main = "Network (colored by Department)")
legend("topright", unique_depts, fill = colors, cex = 0.7, bty = "n")
```

\newpage

## Question 2.2: Connected Components

### x) Find connected components

```{r q2.2x}
comp <- components(email_graph)
cat("Number of components:", comp$no, "\n")
```

### y) Largest component size

```{r q2.2y}
lcc_size <- max(comp$csize)
cat("Largest component:", lcc_size, "employees\n")
cat(round(lcc_size / vcount(email_graph) * 100, 1), "% of employees are in this component\n")
```

### z) Extract and plot largest component

```{r q2.2z}
lcc_id <- which.max(comp$csize)
lcc_nodes <- which(comp$membership == lcc_id)
lcc <- induced_subgraph(email_graph, lcc_nodes)

cat("LCC has", vcount(lcc), "nodes and", ecount(lcc), "edges\n")

deg_lcc <- degree(lcc)
depts_lcc <- V(lcc)$department

par(mar = c(1, 1, 2, 5))
plot(lcc, vertex.label = NA, vertex.size = sqrt(deg_lcc) * 2,
     vertex.color = colors[depts_lcc], edge.width = 0.5,
     main = "Largest Connected Component")
legend("topright", unique_depts, fill = colors, cex = 0.7, bty = "n")
```

### aa) Why use the largest connected component?

To calculate closeness centrality of nodes, every node must be reachable from every other node. If selected nodes are in different components (i.e., graph is disconnected), some distances become infinite or undefined and the calculation breaks. Focusing on the largest component helps avoid this problem and gives meaningful values that can be interpreted and compared. When computing closeness on the largest connected component, within the largest connected component, every node can reach every other node, so the closeness values are properly defined and thus, we can compare them fairly.

\newpage

## Question 2.3: Centrality Metrics

### bb) Degree Centrality

```{r q2.3bb}
deg_cent <- degree(lcc)
deg_df <- data.frame(id = as.integer(V(lcc)$name), degree = deg_cent) %>%
  left_join(employees %>% select(employee_id, name), by = c("id" = "employee_id")) %>%
  select(id, name, degree) %>%
  arrange(desc(degree))

cat("Top 5 by degree:\n")
head(deg_df, 5)

par(mar = c(1, 1, 2, 5))
plot(lcc, vertex.label = NA, vertex.label.cex = 0.5,
     vertex.size = 2 * sqrt(deg_cent), vertex.color = colors[depts_lcc],
     edge.width = 0.5, main = "Network (sized by Degree)")
legend("topright", unique_depts, fill = colors, cex = 0.6, bty = "n")
```

```{r}

```

### cc) Closeness Centrality

```{r q2.3cc}
close_cent <- closeness(lcc, normalized = TRUE)
close_df <- data.frame(id = as.integer(V(lcc)$name), closeness = close_cent) %>%
  left_join(employees %>% select(employee_id, name), by = c("id" = "employee_id")) %>%
  select(id, name, closeness) %>%
  arrange(desc(closeness))

cat("Top 5 by closeness:\n")
head(close_df, 5)
```

High closeness centrality means the employee is “near” a lot of other people in the network, so they can reach others quickly and information can get to them quickly too. In practical terms, they are usually well-positioned for fast coordination and spreading updates across the organization, even if they’re not necessarily the main bridge between different groups.

### dd) Betweenness Centrality

```{r q2.3dd}
btw_cent <- betweenness(lcc, normalized = TRUE)
btw_df <- data.frame(id = as.integer(V(lcc)$name), betweenness = btw_cent) %>%
  left_join(employees %>% select(employee_id, name), by = c("id" = "employee_id")) %>%
  select(id, name, betweenness) %>%
  arrange(desc(betweenness))

cat("Top 5 by betweenness:\n")
head(btw_df, 5)
```

Betweenness centrality measures how often an employee sits in the middle of the shortest routes connecting other employees. Thus, if someone has high betweenness, they usually act as a bridge between different clusters or teams, meaning they can connect communities that may otherwise be disconnected and shape how information moves across the organization, and if they step out or disengage, communication between groups can slow down or become more fragmented.

### ee) PageRank

```{r q2.3ee}
pr <- page_rank(lcc)$vector
pr_df <- data.frame(id = as.integer(V(lcc)$name), pagerank = pr) %>%
  left_join(employees %>% select(employee_id, name), by = c("id" = "employee_id")) %>%
  select(id, name, pagerank) %>%
  arrange(desc(pagerank))

cat("Top 5 by PageRank:\n")
head(pr_df, 5)
```

Degree centrality is the direct count of how many people an employee is connected to. PageRank is different because it also cares who those connections are with, meaning being connected to important people boosts the score more than being connected to less influential ones. In practical terms, a high degree can mean talking to a lot of people, but PageRank can still rate someone highly even with fewer connections if those connections are to very influential people (higher quality links).

### ff) Comparing all metrics

```{r q2.3ff}
all_cent <- data.frame(
  id = as.integer(V(lcc)$name),
  degree = deg_cent,
  closeness = close_cent,
  betweenness = btw_cent,
  pagerank = pr
) %>%
  left_join(employees %>% select(employee_id, name, department, role),
            by = c("id" = "employee_id")) %>%
  select(id, name, dept = department, role, degree, closeness, betweenness, pagerank)

top10 <- all_cent %>% arrange(desc(degree)) %>% head(10)
top10

# Rankings
top10 %>%
  mutate(
    deg_r = rank(-degree),
    close_r = rank(-closeness),
    btw_r = rank(-betweenness),
    pr_r = rank(-pagerank)
  ) %>%
  select(id, name, deg_r, close_r, btw_r, pr_r)
```

Yes, Eve Thompson (ID 5) ranks highly on all metrics. She’s tied-highest on degree (20), has the highest closeness (\~0.0299) and highest PageRank (\~0.0422) among the top 10 employees by degree, and very high betweenness (\~0.288) as well. This pattern shows that Eve is someone who is both broadly connected (degree), centrally positioned in terms of short paths (closeness), frequently sits on key routes between others (betweenness), and is connected to other important nodes (PageRank). Other employees, such as Yuki Tanaka (ID 25) and Nathan Lee (ID 14), have high betweenness (\~0.283 and \~0.338, respectively) but only moderate degree centrality (11 and 10, respectively), which suggests that they may not know many other employees but are still central to facilitating communication. There are also employees, such as Wendy Clark (ID 23), who have a high PageRank score (\~0.040) but moderate closeness centrality (\~0.026), which implies that while they may not be able to spread information fast, they have connections with influential people in the network. On the other hand, Grace Okonkwo (ID 7) ranks within the top 10 by degree (11) but has very low betweenness (\~0.0057), which fits the idea of being connected within her immediate team, but is not a main connector between different teams.

\newpage

## Question 2.4: Community Detection

### gg) Spinglass clustering

```{r q2.4gg}
set.seed(42)
comm <- cluster_spinglass(lcc)

cat("Communities found:", length(comm$csize), "\n")
cat("Modularity:", round(modularity(comm), 3), "\n")
```

### hh) Community sizes

```{r q2.4hh}
mem <- membership(comm)
table(mem)
```

### ii) Visualize by community

```{r q2.4ii}
num_comm <- length(unique(mem))
comm_colors <- brewer.pal(max(3, num_comm), "Set2")

par(mar = c(1, 1, 2, 5))
plot(lcc, vertex.label = NA, vertex.label.cex = 0.5,
     vertex.size = 5, vertex.color = comm_colors[mem],
     edge.width = 0.5, main = "Network (colored by Community)")
legend("topright", paste("Comm", 1:num_comm), fill = comm_colors[1:num_comm],
       cex = 0.6, bty = "n")
```

### jj) Community vs Department

```{r q2.4jj}
comm_dept <- data.frame(
  id = as.integer(V(lcc)$name),
  community = mem,
  department = V(lcc)$department
) %>%
  left_join(employees %>% select(employee_id, name), by = c("id" = "employee_id"))

xtab <- table(comm_dept$community, comm_dept$department)
cat("\nNumber of employees:\n")
xtab

cat("\nPercentages:\n")
round(prop.table(xtab, 1) * 100, 1)
```

Yes, the detected communities align strongly with departments as each community is dominated by one department. For every community, 100 percent of its members come from a single department, with no mixing across departments. This pattern suggests that communication within the organization is highly siloed. However, this community detection is based on who emails whom, thus it is possible that people still work cross-functionally physically but the email data is still primarily department-based.

### kk) Business insights

Understanding TechConnect’s communication communities provides management with a practical lens for improving coordination and execution. Since communication largely occurs within well-defined groups, management should not assume that information or decisions naturally diffuse across the organization. Instead, communication across teams is likely to depend on deliberate intervention.

The community structure highlights the importance of individuals who connect different groups. These bridging employees play a disproportionate role in transmitting information across teams, coordinating work, and preventing misalignment. As a result, they represent both a strategic asset and a potential vulnerability if their roles are informal or unsupported.

Community insights can also inform how TechConnect designs cross-functional initiatives. Because collaboration does not emerge organically at the group level, cross-department projects may require explicit communication structures, such as designated liaisons or joint reporting mechanisms, to function effectively.

Finally, understanding community boundaries enables more targeted change management. When rolling out organizational changes, policies, or strategic initiatives, management can engage influential members within each community to improve adoption and reduce miscommunication, rather than relying solely on broad, organization-wide announcements.

\newpage

# Part 3: Integration and Insights

## Question 3.1: Joining Data

### ll) Join employee data with centrality metrics

```{r q3.1ll}
cent_df <- data.frame(
  employee_id = as.integer(V(lcc)$name),
  degree = degree(lcc),
  closeness = closeness(lcc, normalized = TRUE),
  betweenness = betweenness(lcc, normalized = TRUE),
  pagerank = page_rank(lcc)$vector
)

combined <- employees %>%
  inner_join(cent_df, by = "employee_id")

combined %>%
  select(employee_id, name, department, performance_score,
         degree, closeness, betweenness, pagerank) %>%
  head(10)
```

### mm) Correlation analysis

```{r q3.1mm}
cat("Degree vs Performance:", round(cor(combined$degree, combined$performance_score), 3), "\n")
cat("Closeness vs Performance:", round(cor(combined$closeness, combined$performance_score), 3), "\n")
cat("Betweenness vs Performance:", round(cor(combined$betweenness, combined$performance_score), 3), "\n")
cat("PageRank vs Performance:", round(cor(combined$pagerank, combined$performance_score), 3), "\n")
```

Network centrality does have a moderate positive relationship with performance since all four centrality scores are correlated positively with performance, from 0.477 (Betweenness vs Performance) to 0.745 (PageRank vs Performance). PageRank has the strongest relationship with performance, so being connected to other important people seems most related to a better performance. Closeness (0.70) and degree (0.69) are also important to doing well, signaling that shorter distances and number of connections are important to performance. Betweenness (0.48) is weaker, which means bridging between groups is less important than the other centrality scores for performance.

Correlation of degree centrality and performance score is 0.691.

### nn) High performers with low centrality

```{r q3.1nn}
med_deg <- median(combined$degree)
cat("Median degree:", med_deg, "\n\n")

combined %>%
  filter(performance_score > 4.0 & degree < med_deg) %>%
  select(employee_id, name, department, role, performance_score, degree, projects_completed) %>%
  arrange(desc(performance_score))
```

While employees like Tara Jenkins (employee ID: 46) do great work, they are flying under the radar network-wise. They may be specialists who do not need to talk to other employees as much, or more introverted. Management should make sure these employees are not overlooked for promotions simply because they are not as visible in the network. Additionally, these employees could be underutilized and could benefit from more collaboration opportunities. They may also need mentorship to expand their network influence and visibility within the organization.

\newpage

## Question 3.2: Executive Summary
### Additional Analyses Supporting the Executive Summary**

This section summarises supporting analyses referenced in the Executive Summary. It provides compact tables for management interpretation.

**A1. Top performers by combined performance and network position**

The following table highlights employees who rank highly on both performance score and network degree (as a proxy for connectivity).

```{r top-perf-combined, echo=FALSE}
combined %>%
  mutate(
    perf_rank = rank(-performance_score),
    deg_rank  = rank(-degree)
  ) %>%
  arrange(perf_rank + deg_rank) %>%
  select(name, department, role, performance_score, degree) %>%
  head(5)
```

**A2. Department summary with performance and network metrics**

This table summarises average performance and network position by department.

```{r dept-performance-network, echo=FALSE}
combined %>%
  group_by(department) %>%
  summarise(
    n = n(),
    avg_perf = mean(performance_score, na.rm = TRUE),
    avg_deg  = mean(degree, na.rm = TRUE),
    avg_btw  = mean(betweenness, na.rm = TRUE)
  ) %>%
  arrange(desc(avg_perf))
```
**A3. Performance by experience level**

To examine how performance and coordination responsibilities evolve with tenure, we analyze average performance, project involvement, and network position across experience levels.

```{r perf-by-exp, echo=FALSE}
perf_by_experience <- combined %>%
  group_by(years_exp) %>%
  summarise(
    n = n(),
    avg_perf = mean(performance_score, na.rm = TRUE),
    avg_projects = mean(projects_completed, na.rm = TRUE),
    avg_degree = mean(degree, na.rm = TRUE),
    avg_pagerank = mean(pagerank, na.rm = TRUE)
  ) %>%
  arrange(years_exp)

perf_by_experience
```
**A4. Performance by project load**

Employees are grouped into low, medium, and high project load bands to assess how workload relates to performance and communication roles.
```{r perf-by-proj-load, echo=FALSE}
perf_by_project_load <- combined %>%
  mutate(
    project_band = case_when(
      projects_completed >= quantile(projects_completed, 0.75, na.rm = TRUE) ~ "High load",
      projects_completed <= quantile(projects_completed, 0.25, na.rm = TRUE) ~ "Low load",
      TRUE ~ "Medium load"
    )
  ) %>%
  group_by(project_band) %>%
  summarise(
    n = n(),
    avg_perf = mean(performance_score, na.rm = TRUE),
    avg_degree = mean(degree, na.rm = TRUE),
    avg_betweenness = mean(betweenness, na.rm = TRUE)
  ) %>%
  arrange(desc(avg_perf))

perf_by_project_load
```
**A5. Key communication hubs**

The following table lists employees with the highest betweenness centrality, highlighting individuals who play critical bridging roles in internal communication.

```{r communication-hubs, echo=FALSE}
hubs <- combined %>% arrange(desc(betweenness)) %>% head(3)
hub_names <- paste(hubs$name, collapse = ", ")
```

### Executive Summary for TechConnect Management

**Overview**

We analyzed TechConnect’s employees and email communication data to assess performance and information flow. While overall performance is strong, communication and workload are concentrated within departments and among a small group of highly connected employees, creating coordination and resilience risks as the organization scales.

**Performance Findings**

TechConnect’s average performance score is 3.97 out of 5, with 612 projects completed, indicating strong organization-wide performance. We identified 23 standout performers (performance \> 4.0 with 10+ projects each). Performance varies across departments, with Engineering leading (average \~4.25), while Marketing (\~3.86) and HR (\~3.76) lag, indicating scope for targeted capability development in latter teams.

Employee performance increases steadily with experience and stabilizes after approximately 7–8 years. Experienced employees take on more projects and exhibit higher network centrality, indicating expertise, influence, and coordination responsibilities accumulate with tenure. However, at senior levels, project load and communication demands continue to rise while performance gains plateau, suggesting diminishing returns and potential coordination overload. Performance is also strongly associated with project involvement: employees handling higher project loads consistently outperform their peers.

**Network Structure**

The email network is largely connected through one dominant component, enabling organization-wide information flow. However, community detection shows communication remains strongly clustered by department. This reflects strong within-department coordination but limited cross-functional exchange, creating functional silos that may slow decision-making and increase friction in multi-department initiatives.

**Key Employees**

Eve Thompson stands out as a critical communicator, ranking highly across multiple centrality metrics. Her broad connections and bridging position make her departure a significant organizational risk. Nathan and Yuki similarly act as key connectors with high betweenness centrality. Overreliance on them risks company-wide information breakdowns if they become overloaded or leave.

**Recommendations for TechConnect**

1.  To address siloed communication patterns, TechConnect should define shared OKRs and institutionalize regular cross-functional forums (e.g., monthly syncs) to ensure the organization moves toward a common vision and prevent small disconnects from becoming major bottlenecks.

2.  Employees with high betweenness centrality (e.g. Eve, Nathan) should be formally deployed as cross-functional coordinators, with clear role definitions and resourcing. To avoid coordination overload as tenure increases, senior employees should focus on high-impact decision-making and mentoring, supported by delegation structures, while mid-tenure staff take on greater project ownership to build capacity.

3.  Not all top contributors are highly networked. Employees like Tara Jenkins may deliver strong performance but remain under-recognized. Proactively acknowledging their contributions and involving them in strategic initiatives reinforces engagement and supports talent retention.